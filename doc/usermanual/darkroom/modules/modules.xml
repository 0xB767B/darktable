<sect1 status="final"><title>Modules</title>
	<para>Each correction, enhancement or effect is implemented as modules, and this section includes documentation
			of each module and its specific parameters.
			A module consists of an expander bar <inlinegraphic fileref="&img_module_expander;" scalefit="1" width="30%" align="center"/>  
			where the <inlinegraphic fileref="&icon_module_enable;" scalefit="1" width="2%"  align="center"/> icon  is used to turn then module
			on or off, then there are a title of the module press this to expand the module to see the parameters user interface.
			<inlinegraphic fileref="&icon_module_presets;" scalefit="1" width="2%" align="center" /> icon is the preset icon to access the available presets stored for the module or to create new ones. 
			The <inlinegraphic fileref="&icon_module_reset;" scalefit="1" width="2%" align="center"/>  icon is used to reset the module parameters to their default values.
	</para>
	<sect2 status="draft"><title>Interacting with modules</title>
	   <para>For each slider, you can interact in three different ways, depending on the level of control you need.
	   </para>
	    <orderedlist>
			   <listitem>
			     <para>Arrows</para>
			     <para> You can use the arrows around the slider to control precisely the increase/decrease of the value.
			     </para>
			   </listitem>
			   <listitem>
			     <para>Mouse wheel</para>
			     <para>Hover a slider with your mouse, then use your mouse wheel to adjust by step the value.
			     </para>
			   </listitem>
   			   <listitem>
			     <para>Right-click</para>
			     <para>Your mouse being over a slider, right-click gives you numerical access the slider values.
			     Note that the numerical value needed to be entered is sometimes different from the one displayed.
			     For example, the percentage repartition is displayed as X/Y (eg 70/30) but numerical value to be entered
			     is -1 for 0/100, 0 for 50/50 and 1 for 0/100.
			     </para>
			   </listitem>		
   			   <listitem>
			     <para>Double-click on parameter label</para>
			     <para>In some modules, you can double-click on a parameter label to reset its value to default.
			     </para>
			   </listitem>		   
			</orderedlist>
	</sect2>

	<sect2 status="draft"><title>Blending operators</title>
		<para>Blending operators are a functionality that works on the incoming image information and 
				the output of the current module. Not all modules support blending because it would not work
				and break the use of the module.
		</para>
		<para>Modules that do support blending, inherit additional controls at the bottom of module user interface to control
			parameters of the blending.
		</para>
	

		<sect3><title>Blend Modes</title>
			<para>There are several modes implemented and more can be added, for now all the common ones are there and
			      you will recognize a few of them from other imaging software. A good introduction on many
        	              common blend modes is given in The Gimp Manual (Chapter 8.2, "Layer Modes"). Therefore we
        	              only discuss a few blend modes here in more detail.
			</para>

			<sect4 status="draft"><title>Normal</title>
				<para>This will probably be the most used blend mode, it does just mix input and output and will be used
				      to control the modules effect amount for an example. Perfect for better controlling raw denoise result.
			        </para>			
			</sect4>

		        <sect4 status="draft"><title>Inverse</title>
				<para>This blend mode acts similar to blend mode "Normal", only that the role of input and output of the
        	                      current module are reversed. Can be used together with conditional blending (next chapter) to
        	                      get the effect of an inversed blend mask.
        	                </para>			
			</sect4>

			<sect4 status="draft"><title>Unbounded</title>
				<para>This blend mode acts similar to blend mode "Normal", only that input and output data are not
        	                      clamped to a certain min/max value range. This already tells you that all other blend modes
        	                      clamp their input and output. In some cases (e.g. highly color saturated extreme highlights) it is 
        	                      important to  let unbound values traved through the pixelpipe in order to properly deal with them at 
        	                      the right place (e.g. in module "output color profile").
	                        </para>			
	                </sect4>

			<sect4 status="draft"><title>Coloradjustment</title>
				<para>Some modules act predominantly on the tonal values of an image but involve some adjustment of color saturation
                                      as well, e.g. module "levels". This blend mode completely takes the lightness of the output data and
                                      mixes colors from input and output. This way you can control the modules automatic color adjustment.
	                        </para>			
	                </sect4>


	                   <!--
				<sect4 status="draft"><title>Multiply</title>
					<para></para>			
				</sect4>
				<sect4 status="draft"><title>Average</title>
					<para></para>			
				</sect4>
				<sect4 status="draft"><title>Add</title>
					<para></para>			
				</sect4>
				<sect4 status="draft"><title>Substract</title>
					<para></para>			
				</sect4>
				<sect4 status="draft"><title>Difference</title>
					<para></para>			
				</sect4>
				<sect4 status="draft"><title>Screen</title>
					<para></para>			
				</sect4>
				<sect4 status="draft"><title>Overlay</title>
					<para></para>			
				</sect4>
				<sect4 status="draft"><title>Soft light</title>
					<para></para>			
				</sect4>
				<sect4 status="draft"><title>Hard light</title>
					<para></para>			
				</sect4>
				<sect4 status="draft"><title>Vivid light</title>
					<para></para>			
				</sect4>
				<sect4 status="draft"><title>Linear light</title>
					<para></para>			
				</sect4>
				<sect4 status="draft"><title>Pin light</title>
					<para></para>			
				</sect4>  -->
		</sect3> 
		
		<sect3><title>Opacity</title>
			<para>This slider controls the amount of blending. A value of 100% gives the module's full effect into the
        	              pixelpipe; a value of 0% means no effect of this module. With blend mode Normal and a proper selection
        	              of opacity you can therefore control the strength of a module's effect.
			</para>

	        </sect3>

	        <sect3><title>Conditional Blending</title>
        	        <para>Most modules offer additional control on blending by a user-defined blend mask. In order to activate these
        	              controls you need to switch from "blend uniformily" to "blend only, if..". More details on conditional blending
        	              are given in a separate chapter.
        	        </para>
	        </sect3>

		<sect3><title>Examples</title>
			<sect4 status="draft"><title>Texturing an image</title>
				<para>The watermark module supports svg files with embedded images and thanks to it we can easily texture an 
						image using the watermark module in conjunction with a blending operator.
				</para>
			</sect4>
		
			<sect4 status="draft"><title>Gritty details</title>
				<informaltable frame="none"><tgroup cols="2" colsep="0" rowsep="0">
						<colspec colwidth='70%'/>
						<colspec colwidth='30%'/>
						<tbody>
							<row>						
								<entry>When blending operators were introduced into darktable, a new module named highpass was added. It produces
										a highpass filter of the image to be implicitly used with blending. It allows to produce a gritty detailed image and
										is a widely used workflow with other imaging softwares.				
								</entry>
								<entry>
									<graphic fileref="darkroom/modules/images/blendop_highpass.png" scalefit="1" width="80%" align="center" />
								</entry>
							</row>
						</tbody>
					</tgroup>
				</informaltable>
			
				<para>
					<informaltable frame="none"><tgroup cols="2" colsep="0" rowsep="0">
							<colspec colwidth='30%'/>
							<colspec colwidth='70%'/>
							<tbody>
								<row>
									<entry>
										<graphic fileref="darkroom/modules/images/blendop_highpass_ex1_1.png" scalefit="1" width="90%" align="center" />
									</entry>						
									<entry>
										<para>This is the original image, pretty heavy processed: first black and white, then some blue splittoning but as you see
											it lacks pop in details and is a bit out of focus...
										</para>
									</entry>
								</row>
								<row>
									<entry>
										<graphic fileref="darkroom/modules/images/blendop_highpass_ex1_2.png" scalefit="1" width="90%" align="center" />
									</entry>						
									<entry>
										<para>Here we applied the highpass filter with the values shown in the images above of the module userinterface; 
											you can now see that the details are very boosted and we got a really gritty detailed image.
										</para>
									</entry>
								</row>
							</tbody>
						</tgroup>
					</informaltable>
				</para>
			</sect4>
		
		</sect3>
	</sect2>

	<sect2 status="draft"><title>Conditional blending</title>
		<para>Conditional blending offers a fine-grained control as to what extent blending is applied to different pixels of an image. 
        	      It does so by generating an intermediate blend mask, constructed with user defined parameters. These parameters act in color 
        	      coordinates, not in geometrical coordinates. 
		</para>

	        <para>That said, conditional blending is a powerful tool with a certain level of complexity.
        	</para>

	        <sect3><title>Working principle</title>
		        <para>For each data channel of a module (Lab, RGB) and additionally for several virtual data channels (e.g. hue, saturation) users can construct
	        	      a per-channel opacity function. The function has the form of a trapezoid. Depending on the data channel's value this function determines 
	        	      a blending factor between 0 and 1. 
		        </para>
		        <para>Each pixel of an image thus has different blending factors for each of its data channels (real and virtual). All blending 
	        	      factors are finally pixel-wise multiplied together with the value of the global opacity slider (see chapter "Blend Modes") to form a 
	        	      blend mask for the image.
		        </para>
		        <para>If for a given pixel the blend mask has a value of 0, the input of the module is left unchanged. If for a pixel the
		              blend mask has its maximum value of 1 (or 100%), the module has full effect. 
		        </para>
	        </sect3>


		<sect3><title>Overview of controls</title>
		        <para>
			<informaltable frame="none"><tgroup cols="2" colsep="0" rowsep="0">
			<colspec colwidth='70%'/>
			<colspec colwidth='30%'/>
			<tbody>
				<row>						
					<entry>When conditional blending is activated with option "blend only, if.." an additional set of controls consisting
		                               of several notebook tabs is shown.
					</entry>
					<entry>
						<graphic fileref="darkroom/modules/images/blendif_1.png" scalefit="1" width="80%" align="center" />
					</entry>
				</row>
			</tbody>
			</tgroup>
			</informaltable>
		        </para>
	        </sect3>

	        <sect3><title>Notebook tabs</title>
		        <para>Each notebook tab represents a data channel - real or virtual. Modules acting in Lab color space have data channels for
		              L, a, b, C (chroma of LCh) and h (hue of LCh). Modules acting in RGB color space have data channels for g (grey), R, G, B,
		              H (hue of HSL), S (saturation of HSL), and L (lightness of HSL). Consult http://en.wikipedia.org/wiki/Color_space for a deeper
		              look into different color spaces.
		        </para>
		        <para>
		              Within each notebook tab two color channel sliders are given; one for the input data that the module receives; and one for
		              the output data that the module produces prior to blending.
		        </para>
	        </sect3>

	        <sect3><title>Control buttons</title>
		        <para>Control buttons help you when designing a blend mask. With the eye button 
                              <inlinegraphic fileref="&icon_module_eye;" scalefit="1" width="2%" align="center" /> you can temporarily deactivate the blend mask;
		              blend mode and global opacity slider remain in effect. Switch this button on and off to see if the module is acting on
		              the image as intended. With the mask button <inlinegraphic fileref="&icon_module_mask;" scalefit="1" width="2%" align="center" /> 
                              you can directly see the blend mask as a yellow overlay over a black and white copy of the image; the stronger the yellow color, 
                              the higher the blend mask value. With the color picker button <inlinegraphic fileref="&icon_module_picker;" scalefit="1" width="2%" align="center" /> 
                              you can select a probe from your image. The corresponding values for the real and virtual data channels are displayed in each color channel slider. 
		              With the reset button <inlinegraphic fileref="&icon_module_reset;" scalefit="1" width="2%" align="center" /> you can put all conditional blending 
                              settings back to there default state.
		        </para>
	        </sect3>

	        <sect3><title>Color channel sliders</title>
		        <para>With the color channel slider you construct a trapezoidal opacity function. For this purpose there are four markers per slider.
		              Two triangles above the slider; they mark the range of values where opacity is 1.
		              Two triangles below the slider; they mark the range values where opacity is zero.
		        </para>
                        <para>
			      The filled triangles indicated the closed (mostly narrower) edge of the trapezoidal function. The open triangles indicate the open
                              (mostly wider) edge of the trapezoidal function.
                        </para>
		        <para>
		              In its default
		              settings the markers are at the extreme positions left and right of the slider. The sequence of the markers always remains 
		              unchanged: they can touch but they can not switch position.
		        </para>
		        <para>
		              A polarity button right to the slider defines what pair of triangles defines the closed edge of the trapezoid: positive for
		              the upper triangles (corresponding to opacity 1); negative for the lower triangles (opacity 0). This allows for two principle types of 
                              trapezoidal functions which are represented graphically in the following images.
		        </para>
		        <para>
			<informaltable frame="none"><tgroup cols="2" colsep="0" rowsep="0">
			<colspec colwidth='50%' align='center'/>
			<colspec colwidth='50%' align='center'/>
			<tbody>
				<row>						
					<entry>
		                                <graphic fileref="darkroom/modules/images/blendif_2a.png" scalefit="1" width="80%" align="center" />
					</entry>
					<entry>
						<graphic fileref="darkroom/modules/images/blendif_3a.png" scalefit="1" width="80%" align="center" />
					</entry>
				</row>
				<row>						
					<entry>
		                                <graphic fileref="darkroom/modules/images/blendif_2b.png" scalefit="1" width="80%" align="center" />
					</entry>
					<entry>
						<graphic fileref="darkroom/modules/images/blendif_3b.png" scalefit="1" width="80%" align="center" />
					</entry>
				</row>
				<row>						
					<entry>
		                                <para>A trapezoidal function that selects a narrow range of values for blending.
		                                </para>
					</entry>
					<entry>
        		                        <para>A trapezoidal function that excludes a narrow range of values from blending.
        		                        </para>
					</entry>
				</row>


			</tbody>
			</tgroup>
			</informaltable>
		        </para>
	        </sect3>

	        <sect3><title>Mask blur</title>
		        <para>The mask blur slider applies a gaussian blur to the final blend mask. The higher the radius, the stronger the blur;
		              set to 0 for an unblurred mask. This option is useful to get a softer transitions between blended and unblended parts
		              of an image and avoids artifacts.
		        </para>
	        </sect3>

	        <sect3><title>Examples</title>
			<sect4 status="draft"><title>Colorkey effect</title>
	                        <para>
				<informaltable frame="none"><tgroup cols="2" colsep="0" rowsep="0">
				<colspec colwidth='70%'/>
				<colspec colwidth='30%'/>
				<tbody>
					<row>						
						<entry>
							<para>
							To make a colorkey effect for this red poppy blossom, we need to apply module monochrome to
                                             	               all parts of the image except of the saturated red petals.			
							</para>
						</entry>
						<entry>
							<graphic fileref="darkroom/modules/images/blendif_4.png" scalefit="1" width="80%" align="center" />
						</entry>
					</row>
					<row>
						<entry>
							<para>These settings in hue channel construct a blend
                                                               mask that excludes the red petals. The small white bar in the gradient is generated by color
                                                               picker taking up a probe from withing the petals.
							</para>
						</entry>

						<entry>
							<graphic fileref="darkroom/modules/images/blendif_5.png" scalefit="1" width="80%" align="center" />
						</entry>
					</row>
					<row>
						<entry>
							<para>The resulting blend mask.
							</para>
						</entry>						
						<entry>
							<graphic fileref="darkroom/modules/images/blendif_6.png" scalefit="1" width="80%" align="center" />
						</entry>						
					</row>
					<row>						
						<entry>
							<para>The final image after module monochrome is applied.
                                          		</para>
						</entry>
						<entry>
							<graphic fileref="darkroom/modules/images/blendif_7.png" scalefit="1" width="80%" align="center" />
						</entry>
					</row>
				</tbody>
				</tgroup>
				</informaltable>
        	                </para>
	
			</sect4>
		
		</sect3>

	</sect2>

    <sect2 status="final"><title>Presets</title>
		    <para>
			    Presets are stored configurations for the module parameters both internal and user-defined is available	through clicking the <inlinegraphic fileref="&icon_module_presets;"  scalefit="1" width="2%" align="center"/> icon and a list of available presets are shown for your choice, the activated preset is in bold text.
		    </para>
		    <para>
			    The preset system does also support automatic preset selection based on image data such as focal length, iso,  
				    camera model and much more fields.
    </para>
		    <sect3><title>Creating a new preset</title>
			    <para>
				    Configure the specific module of choice as you like then you click the <inlinegraphic fileref="&icon_module_presets;"  scalefit="1" width="2%" align="center"/> icon and select store new preset menu choice. Following dialog will be shown to configure the preset:
			    </para>
			    <graphic fileref="darkroom/modules/images/new_preset.png" scalefit="1" width="60%" align="center" />
			    <para>
				    The first two fields are used for setting a name and a description of the preset.
			    </para>
			    <para>
			    In the example i have also checked the auto apply option which brings up the image selection fields where you can define a filter that is used to decide if the preset should be applied the image or not.	The example dialog above does set up following rules, if lens name matches and aperture is >= 8 and focal length is in range 24 - 35mm the preset will be automatically applied, it will also only show in the preset list if the image does match this rule.
			    </para>
			    <para>
				    The data used is the EXIF information so if you want a preset to be applied to all images from a specific camera, then leave all fields at default values,	lookup model string in metadata panel and enter it into the model field.
			    </para>
            </sect3>
        </sect2>
	

	<!--&darkroom_module_rawimport;-->
	<!--&darkroom_module_denoise;-->
	
	&darkroom_module_whitebalance;
	&darkroom_module_rawdenoise;
	&darkroom_module_chromatic; 
	&darkroom_module_demosaic;
	&darkroom_module_invert;
	&darkroom_module_tonemapping;
	&darkroom_module_exposure;
	&darkroom_module_highlightreconstruction;
	&darkroom_module_graduatedneutraldensity;
	&darkroom_module_basecurve;
	&darkroom_module_lenscorrection;
	&darkroom_module_unbreakinputprofile;
	&darkroom_module_inputcolorprofile;
	&darkroom_module_bloom;	
	&darkroom_module_spotremoval;	
	&darkroom_module_colortransfer;
	<!--&darkroom_module_equalizer;-->
	&darkroom_module_equalizer2;
	&darkroom_module_colorzones;
	&darkroom_module_lowlight;
	&darkroom_module_monochrome;
	&darkroom_module_shadhi;
	&darkroom_module_zonesystem;
	&darkroom_module_tonecurve;
	&darkroom_module_relight;
	&darkroom_module_colorcorrection;
	&darkroom_module_sharpen;
	&darkroom_module_grain;
	&darkroom_module_colorcontrast;
	&darkroom_module_localcontrast2;	
	&darkroom_module_clipping;
	&darkroom_module_highpass;
	&darkroom_module_lowpass;
	&darkroom_module_outputcolorprofile;
	&darkroom_module_channelmixer;
	<!--&darkroom_module_localcontrast;-->
	&darkroom_module_velvia;
	&darkroom_module_soften;  	  	
	&darkroom_module_vignetting;
	&darkroom_module_splittoning;
	&darkroom_module_watermark;
	&darkroom_module_overexposed;
	&darkroom_module_framing;
</sect1>
